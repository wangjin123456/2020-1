1，如何保证我们的支付的系统安全性？
对称加密：
 概述： 加密和解密都是采用同一个秘钥
 生成秘钥： key=8888
 明文参数 meite meitei+秘钥实现加密=99999
 解密： 直接使用秘钥解密 99999
 
 对称加密的算法有哪些： des aes
 对称加密存在很大缺陷： 因为加密和解密都是通过一个秘钥，可以通过客户端源代码查找到秘钥，所以不安全
 
 一些支付接口基本上都是采用rsa公钥和私钥互换的机制传递
 
 RSA分对称加密 公钥和私钥互换的机制
 概述：
 1，公钥公开的秘钥
 2，私钥不公开的秘钥
 RSA特性： 加密和解密不能够使用同一个秘钥，
 生成一个秘钥对： 公钥和私钥。
 可以采用公钥对我们的数据加密，必须要使用私钥实现解密。
 
 是否可以采用私钥加密，公钥解密？ 理论上可以，但是不安全。
 
 
 对称加密，不安全，但是效率高
 非对称加密 安全， 但是效率低，比较核心的支付用非对称加密
 
 2.支付API 接口 一定要采用https协议， ssl+证书，属于非对称加密
 默认端口443 http 明文传输默认端口80
 3，如何防止我们的支付接口数据被黑客抓包篡改，签证签名
 MD5加密 肯定不属于 单向不可逆，只有通过暴力破解实现撞库数据库
 MD5加密（明文数据+ 动态盐值）
 MD5。 加密（明文数据+动态盐值）
 验证签名到底是如何实现的呢？
 userName =mite 对参数实现md5加密 username=144
 
 完成自己的支付平台：
 1，对接第三方支付渠道 支付宝，微信支付
 2， 支付服务与积分服务
 4，定时对账
 
 
 对接第三方支付接口设计的思想：
 对接第三方支付 支付宝，银联，微信支付，其他支付接口，他们的设计支付思想是一样的；
 就是对接支付宝不同，基于策略模式重构我们的聚合支付平台；
 
 
 对接支付宝案例：
 沙箱环境： 提供支付测试的环境
 
 支付宝中的应用公钥和支付宝公钥表达什么意思？
 
 RSA 就是一对秘钥对 由公钥和私钥组成：
 1，使用公钥对数据加密的情况，必须使用私钥对数据解密
 2，使用私钥加密的情况 ，必须使用公钥加密（没有必要）
 
 公钥是给客户端/商户
 秘钥给服务端；
 
 同步地址和异步地址回调？
 
 
 
 在沙箱环境中，以form方式提交支付，浏览器报错“支付不安全 防止钓鱼网站的方法”

建议采用360 安全浏览器测试即可


对接第三方支付的原理：
1，以form 表单的形式提交参数给第三方支付接口，采用的是post请求；
如何 保证我们的参数安全性
  采用验证签名防止数据被抓包篡改
  采用rsa 公钥与私钥互换的机制实现数据的加密

2，同步回调在支付宝支付完成后，会以浏览器重定向的形式跳转到商品地址（）异步回调
同时会发送报文的结果，商户可以解析报文判断是否支付成功

注意，只有解析报问结果给用户提示是否支付成功，但是不能修改支付宝的支付状态

同步回调发给客户， 异步回调发给商户；


3，异步回调 支付宝以发送类似于http请求的形式，将支付结果告诉商户，商户解析数据的报文，
   如果支付成功同时修改数据库的订单状态。
   
   
   注意： 异步回调本地开发环境测试的时候，需要提供外网映射工具，同步对调的时候本地开发不需要，但是生产环境需要；
   
   伪造异步和同步回调， 不用担心，因为有rsa.
   
   
   
如何判断文件内容是否发生改变？ MD5加密 比较hash值
支付同步回调与异步回调的区别；

 
 中间过程：
 1，form提交参数给支付宝
 商户 支付宝的公钥对提交的参数实现rsa加密
 给支付宝服务器的时候（支付宝的私钥对数据实现解密）
 2，支付宝实现采用回调的方式，（商户公钥）将支付结果以rsa加密
 发送给商户， 商户使用对应的私钥实现对数据解密。
 
 1.订单模块ajax把敏感参数传后台存起来 并获得一个参数令牌
2.订单模块拿令牌去支付模块获取敏感参数生成表单代码
3.表单提交参数到支付宝 生成支付二维码




今日课程
如何保证支付接口参数的安全性？
1，使用非对称加密，但是效率低，
2，使用md5 对参数实现验证签名，采用post 方式提交表单；
3，个人比较推荐使用token

预支付： 提前把参数采用


正常支付流程：
1，调用订单服务接口实现下单-------订单服务

分析支付服务需要提供的接口：
1，提供给订单服务预提交参数；返回支付令牌
2，根据支付令牌查询支付的参数，金额，订单提交from 表单给支付宝

支付渠道接口统一采用从数据库渠道表实现管理
对接支付宝，微信，银联；

基本上大多数支付接口都一样，只是生成的html表单不一样
策略问题可以解决多重if判断的问题；


订单重复提交怎么解决？
如果支付id已经处理了支付宝会做处理，提示已经处理；

支付限时？


订单web传金额到订单服务需要考虑安全问题吗？
这个是后台计算的；

商户订单号码---支付的id
支付宝交易号码--流水号码  补偿机制

如果商户端没有及时的返回success 给支付宝的情况下。重试的过程中，可能会出现幂等的问题

注意： 同步回调以浏览器重定向的，商户端只是解析报问验证签名成功，将支付结果返回给客户。但是不能修改状态
聚合支付回调  设计重构  ？  策略+ 模板方法组合

异步回调代码：
1，记录日志
2，验证签名
3，修改订单状态
4，调用积分接口增加积分


策略模式： 解决我们的多重if判断问题

模板方法模式：   定义共同的骨架，


04/23
今日课程任务
1，异步回调




























